<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <title>FSR WebUI - Minimal</title>
</head>
<body>
<h1>FSR WebUI - Minimal</h1>

<!-- Perfiles: listado generado por Thymeleaf -->
<div>
    <h2>Perfiles</h2>
    <div th:each="p : ${profiles}">
        <form th:action="@{/profile/select}" method="post" style="display: inline;">
            <input type="hidden" name="profileName" th:value="${p.name}" />
            <label th:text="${p.name}">Perfil</label>
            <button type="submit">Seleccionar</button>
        </form>
        <span th:if="${p.name == selectedProfile}"> (activo)</span>
        <br/>
    </div>
</div>

<!-- Sensores: solo labels con números y forms básicos para umbral -->
<div>
    <h2>Sensores</h2>
    <div th:each="i : ${#numbers.sequence(0,3)}">
        <div>
            <label>Sensor <span th:text="${i}">0</span>:</label>
            <label>Valor: <span id="value-[[${i}]]" th:text="${sensorValues[i]}">0</span></label>
            <label>Umbral: <span id="threshold-[[${i}]]" th:text="${thresholds[i]}">0</span></label>

            <form th:action="@{/sensor/{id}/threshold(id=${i})}" method="post" style="display:inline;">
                <input type="number" name="threshold" min="0" max="1023" />
                <button type="submit">Set</button>
            </form>
        </div>
        <br/>
    </div>
</div>

<!-- Minimal JS embebido para STOMP over SockJS (CDN cargado inline) -->
<script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Conexión mínima STOMP sobre SockJS
        var socket = new SockJS('/ws');
        var stompClient = Stomp.over(socket);
        stompClient.connect({}, function () {
            stompClient.subscribe('/topic/sensor', function (msg) {
                try {
                    var data = JSON.parse(msg.body);
                    var id = data.id;
                    if (document.getElementById('value-' + id)) {
                        document.getElementById('value-' + id).innerText = data.value;
                    }
                    if (document.getElementById('threshold-' + id)) {
                        document.getElementById('threshold-' + id).innerText = data.threshold;
                    }
                } catch (e) { console.error(e); }
            });
        }, function (err) { console.error('STOMP error', err); });
    });
</script>
</body>
</html>
